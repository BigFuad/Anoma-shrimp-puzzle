<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Anoma Shrimp Puzzle</title>
<meta name="theme-color" content="#0f2d2a" />
<style>
  :root{
    --bg:#08201d;
    --panel:#0f2d2a;
    --accent:#4de0c7;
    --accent-2:#ffd166;
    --text:#f5f7f7;
    --muted:#b9c5c3;
    --tile:#143c38;
    --gap:6px;
    --radius:12px;
    --shadow:0 8px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Inter,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 20% -10%, #0c3b34, var(--bg));
    color: var(--text);
    display:flex; align-items:center; justify-content:center;
    padding:16px;
  }
  .app{
    width:min(1080px,100%);
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:18px;
  }
  @media (max-width: 950px){
    .app{grid-template-columns:1fr; max-width:680px}
  }
  .panel{
    background:linear-gradient(180deg, #113a34, var(--panel));
    border:1px solid rgba(255,255,255,.06);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px 16px 12px;
  }
  h1{
    margin:0 0 10px;
    font-size: clamp(22px, 2.2vw, 28px);
    letter-spacing:.3px;
    display:flex; align-items:center; gap:10px;
  }
  h1 .shrimp{
    width:30px;height:30px;border-radius:6px;
    background:url('shrimp.png') center/cover no-repeat;
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.15);
  }
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .row + .row{margin-top:10px}
  .select{
    display:flex; gap:8px;
    background:#0e2c28; padding:6px; border-radius:999px;
    border:1px solid rgba(255,255,255,.08)
  }
  .chip{
    border:0; padding:8px 12px; border-radius:999px; cursor:pointer;
    color:var(--muted); background:transparent; font-weight:600;
  }
  .chip[aria-pressed="true"]{background:var(--accent); color:#042522}
  .btn{
    border:0; padding:10px 14px; border-radius:10px; cursor:pointer;
    background:var(--accent); color:#03211f; font-weight:700;
    box-shadow:0 6px 18px rgba(77, 224, 199, .25);
  }
  .btn.secondary{ background:#173d38; color:var(--text); border:1px solid rgba(255,255,255,.08); box-shadow:none}
  .btn:disabled{opacity:.6; cursor:not-allowed}
  label.upload{
    display:inline-flex; align-items:center; gap:10px; cursor:pointer; padding:8px 12px;
    background:#123a35; border:1px dashed rgba(255,255,255,.2); border-radius:10px;
    color:var(--muted); font-weight:600;
  }
  input[type=file]{display:none}

  /* board */
  .board-wrap{
    position:relative;
    aspect-ratio:1/1;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    background:#0b2b28;
    overflow:hidden;
    touch-action:none;
  }
  .board{
    --n:3;
    --gap:var(--gap);
    position:absolute; inset:10px;
    display:grid;
    grid-template-columns: repeat(var(--n), 1fr);
    grid-template-rows: repeat(var(--n), 1fr);
    gap:var(--gap);
    background: #0d2f2b;
    border-radius:12px;
    padding:var(--gap);
  }
  .tile{
    position:relative;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.08);
    background: var(--tile) center/cover no-repeat;
    transition: transform .12s ease-in-out;
    box-shadow: inset 0 0 0 2px rgba(0,0,0,.15), 0 2px 10px rgba(0,0,0,.25);
    display:flex; align-items:end; justify-content:end;
    overflow:hidden;
  }
  .tile:active{transform:scale(.98)}
  .tile button{
    position:absolute; inset:0; border:0; background:transparent; cursor:pointer;
    border-radius:inherit;
  }
  .tile .num{
    margin:6px; padding:2px 7px; font:700 12px/1.3 ui-monospace, SFMono-Regular, Menlo, monospace;
    background:rgba(0,0,0,.45); color:#fff; border-radius:6px; opacity:.9;
  }
  .tile.hidden-nums .num{display:none}
  .hole{visibility:hidden}

  .hud{
    margin-top:12px; display:flex; flex-wrap:wrap; gap:10px; align-items:center
  }
  .stat{padding:8px 12px; border-radius:10px; background:#0f3330; color:var(--text); border:1px solid rgba(255,255,255,.06); font-weight:700}
  .stat small{display:block; font-size:11px; color:var(--muted); font-weight:600}

  .tools{display:flex; flex-wrap:wrap; gap:8px; margin:12px 0}
  details.hint{
    background:#0f3330; border:1px solid rgba(255,255,255,.06); border-radius:10px; padding:8px 10px
  }
  details.hint summary{cursor:pointer; font-weight:700}
  .preview{
    margin-top:8px; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,.08);
    height:140px; background:#0b2b28;
  }
  .preview img{width:100%; height:100%; object-fit:cover}
  .footer{margin-top:10px; color:var(--muted); font-size:13px}
  .toast{
    position:fixed; left:50%; transform:translateX(-50%); bottom:16px;
    background:#112f2b; border:1px solid rgba(255,255,255,.08);
    color:var(--text); padding:10px 14px; border-radius:999px; box-shadow:var(--shadow);
    z-index:9; opacity:0; pointer-events:none; transition:opacity .3s, transform .3s;
  }
  .toast.show{opacity:1; transform:translate(-50%, -6px)}
  .sr-only{position:absolute !important; width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
  <div class="app">
    <section class="panel">
      <h1><span class="shrimp" aria-hidden="true"></span> Anoma Shrimp Puzzle</h1>

      <div class="row" role="group" aria-label="Difficulty">
        <div class="select" id="modeSelect">
          <button class="chip" data-n="3" aria-pressed="true">Easy 3×3</button>
          <button class="chip" data-n="4" aria-pressed="false">Medium 4×4</button>
          <button class="chip" data-n="5" aria-pressed="false">Hard 5×5</button>
        </div>
        <button id="shuffleBtn" class="btn">Shuffle</button>
      </div>

      <div class="row">
        <button id="toggleNums" class="btn secondary" aria-pressed="false">Show numbers</button>
      </div>

      <div class="board-wrap" id="boardWrap" aria-label="Sliding puzzle board">
        <div class="board" id="board" aria-live="polite"></div>
        <div class="sr-only" id="live">Ready</div>
      </div>

      <div class="hud">
        <div class="stat"><small>Moves</small><span id="moves">0</span></div>
        <div class="stat"><small>Time</small><span id="time">00:00</span></div>
        <div class="stat"><small>Best</small><span id="best">—</span></div>
      </div>

      <div class="tools">
        <details class="hint">
          <summary>Hint / Preview</summary>
          <div class="preview"><img id="previewImg" src="shrimp.png" alt="Preview of full image"></div>
        </details>
      </div>
    </section>

    <section class="panel">
      <h2 style="margin:0 0 8px;font-size:18px;color:var(--muted)">How to play</h2>
      <ol style="margin:0 0 12px 18px; line-height:1.5">
        <li>Choose a difficulty and press <b>Shuffle</b>.</li>
        <li>Slide tiles to reassemble the image. The blank space is the hole.</li>
        <li>Use swipe, arrow keys, or click/tap a tile adjacent to the hole.</li>
      </ol>
    </section>
  </div>

<script>
(() => {
  const $ = sel => document.querySelector(sel);
  const $all = sel => Array.from(document.querySelectorAll(sel));
  const formatTime = s => `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  const storageKey = n=>`shrimpPuzzle_${n}`, bestKey=n=>`shrimpPuzzle_best_${n}`;

  let N=3, order=[], hole=0, moves=0, secs=0, timer=null, paused=false, showNums=false;
  let imgURL='shrimp.png';

  const board=$('#board'), movesEl=$('#moves'), timeEl=$('#time'), bestEl=$('#best'), live=$('#live');
  const toggleNumsBtn=$('#toggleNums'), shuffleBtn=$('#shuffleBtn');

  function build(){
    board.style.setProperty('--n',N); board.innerHTML='';
    for(let i=0;i<N*N;i++){
      const tile=document.createElement('div');
      tile.className='tile'; tile.dataset.index=i;
      const r=Math.floor(i/N),c=i%N;
      tile.style.backgroundImage=`url('${imgURL}')`;
      tile.style.backgroundSize=`${N*100}% ${N*100}%`;
      tile.style.backgroundPosition=`${(c/(N-1))*100}% ${(r/(N-1))*100}%`;
      const b=document.createElement('button'); b.addEventListener('click',()=>tryMove(tile));
      tile.appendChild(b);
      const n=document.createElement('div'); n.className='num'; n.textContent=i+1; tile.appendChild(n);
      board.appendChild(tile);
    }
    getTile(N*N-1).classList.add('hole');
    initSolved(); apply(); setNums();
  }
  const getTile=i=>board.querySelector(`.tile[data-index="${i}"]`);
  const apply=()=>order.forEach((idx,pos)=>getTile(idx).style.order=pos);
  const initSolved=()=>{order=Array.from({length:N*N},(_,i)=>i); hole=order.length-1;};
  const setNums=()=>{$all('.tile').forEach(t=>t.classList.toggle('hidden-nums',!showNums));
    toggleNumsBtn.textContent=showNums?'Hide numbers':'Show numbers';
  };

  const posRC=p=>[Math.floor(p/N),p%N], rcPos=(r,c)=>r*N+c;
  const validDirs=()=>{const[r,c]=posRC(hole),d=[];if(r>0)d.push(0);if(c<N-1)d.push(1);if(r<N-1)d.push(2);if(c>0)d.push(3);return d;};
  function slide(dir,countMove=true){
    const[r,c]=posRC(hole); let from;
    if(dir===0)from=rcPos(r-1,c); else if(dir===1)from=rcPos(r,c+1);
    else if(dir===2)from=rcPos(r+1,c); else if(dir===3)from=rcPos(r,c-1);
    if(from==null)return;
    [order[from],order[hole]]=[order[hole],order[from]]; hole=from; apply();
    if(countMove){moves++; update();}
    if(solved()){clearInterval(timer); const best=loadBest(N); if(!best||secs<best)saveBest(N,secs); renderBest(); alert(`Solved in ${moves} moves and ${formatTime(secs)}`);}
  }
  function solved(){return order.every((v,i)=>v===i);}
  function tryMove(tile){
    const idx=+tile.dataset.index,pos=order.indexOf(idx),[tr,tc]=posRC(pos),[hr,hc]=posRC(hole);
    const dr=tr-hr,dc=tc-hc; let dir=null;
    if(dr===-1&&dc===0)dir=2; else if(dr===1&&dc===0)dir=0; else if(dc===-1&&dr===0)dir=1; else if(dc===1&&dr===0)dir=3;
    if(dir!=null)slide(dir,true);
  }

  function shuffle(){
    initSolved(); let last=-1;
    for(let k=0;k<200;k++){const opts=validDirs().filter(d=>Math.abs(d-last)!==2); const d=opts[Math.random()*opts.length|0]; slide(d,false); last=d;}
    moves=0;secs=0;update();clearInterval(timer);timer=setInterval(()=>{secs++;update();},1000);
  }
  function update(){movesEl.textContent=moves; timeEl.textContent=formatTime(secs);}
  const saveBest=(n,v)=>localStorage.setItem(bestKey(n),v), loadBest=n=>+localStorage.getItem(bestKey(n))||null, renderBest=()=>bestEl.textContent=loadBest(N)?formatTime(loadBest(N)):'—';

  shuffleBtn.onclick=shuffle;
  toggleNumsBtn.onclick=()=>{showNums=!showNums;setNums();};

  window.onkeydown=e=>{
    if(['ArrowUp','w','W'].includes(e.key))slide(2);
    else if(['ArrowRight','d','D'].includes(e.key))slide(3);
    else if(['ArrowDown','s','S'].includes(e.key))slide(0);
    else if(['ArrowLeft','a','A'].includes(e.key))slide(1);
    else if(e.key==='h'||e.key==='H'){showNums=!showNums;setNums();}
  };

  $('#modeSelect').onclick=e=>{
    const b=e.target.closest('.chip'); if(!b)return;
    $all('#modeSelect .chip').forEach(c=>c.setAttribute('aria-pressed','false'));
    b.setAttribute('aria-pressed','true'); N=+b.dataset.n; build(); moves=secs=0;update();renderBest();
  };

  build(); renderBest();
})();
</script>
</body>
</html>
