<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Anoma Shrimp Puzzle</title>
<meta name="theme-color" content="#0f2d2a" />
<style>
  :root{
    --bg:#08201d;
    --panel:#0f2d2a;
    --accent:#4de0c7;
    --text:#f5f7f7;
    --muted:#b9c5c3;
    --tile:#143c38;
    --gap:6px;
    --radius:12px;
    --shadow:0 8px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Inter,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 20% -10%, #0c3b34, var(--bg));
    color: var(--text);
    display:flex; align-items:center; justify-content:center;
    padding:16px;
  }
  .app{
    width:min(1080px,100%);
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:18px;
  }
  @media (max-width: 950px){
    .app{grid-template-columns:1fr; max-width:680px}
  }
  .panel{
    background:linear-gradient(180deg, #113a34, var(--panel));
    border:1px solid rgba(255,255,255,.06);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px 16px 12px;
  }
  h1{
    margin:0 0 10px;
    font-size: clamp(22px, 2.2vw, 28px);
    display:flex; align-items:center; gap:10px;
  }
  h1 .shrimp{
    width:30px;height:30px;border-radius:6px;
    background:url('shrimp.png') center/cover no-repeat;
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.15);
  }
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .row + .row{margin-top:10px}
  .select{
    display:flex; gap:8px;
    background:#0e2c28; padding:6px; border-radius:999px;
    border:1px solid rgba(255,255,255,.08)
  }
  .chip{
    border:0; padding:8px 12px; border-radius:999px; cursor:pointer;
    color:var(--muted); background:transparent; font-weight:600;
  }
  .chip[aria-pressed="true"]{background:var(--accent); color:#042522}
  .btn{
    border:0; padding:10px 14px; border-radius:10px; cursor:pointer;
    background:var(--accent); color:#03211f; font-weight:700;
    box-shadow:0 6px 18px rgba(77, 224, 199, .25);
  }
  .btn.secondary{ background:#173d38; color:var(--text); border:1px solid rgba(255,255,255,.08); box-shadow:none}
  .btn:disabled{opacity:.6; cursor:not-allowed}

  /* board */
  .board-wrap{
    position:relative;
    aspect-ratio:1/1;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    background:#0b2b28;
    overflow:hidden;
    touch-action:none; /* custom swipe */
  }
  .board{
    --n:3;
    --gap:var(--gap);
    position:absolute; inset:10px;
    display:grid;
    grid-template-columns: repeat(var(--n), 1fr);
    grid-template-rows: repeat(var(--n), 1fr);
    gap:var(--gap);
    background: #0d2f2b;
    border-radius:12px;
    padding:var(--gap);
  }
  .tile{
    position:relative;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.08);
    background: var(--tile) center/cover no-repeat;
    transition: transform .12s ease-in-out;
    box-shadow: inset 0 0 0 2px rgba(0,0,0,.15), 0 2px 10px rgba(0,0,0,.25);
    display:flex; align-items:end; justify-content:end;
    overflow:hidden;
  }
  .tile:active{transform:scale(.98)}
  .tile button{
    position:absolute; inset:0; border:0; background:transparent; cursor:pointer;
    border-radius:inherit;
  }
  .tile .num{
    margin:6px; padding:2px 7px; font:700 12px/1.3 ui-monospace, SFMono-Regular, Menlo, monospace;
    background:rgba(0,0,0,.45); color:#fff; border-radius:6px; opacity:.9;
  }
  .tile.hidden-nums .num{display:none}
  .hole{visibility:hidden}

  .hud{
    margin-top:12px; display:flex; flex-wrap:wrap; gap:10px; align-items:center
  }
  .stat{padding:8px 12px; border-radius:10px; background:#0f3330; color:var(--text); border:1px solid rgba(255,255,255,.06); font-weight:700}
  .stat small{display:block; font-size:11px; color:var(--muted); font-weight:600}

  details.hint{
    margin-top:12px;
    background:#0f3330; border:1px solid rgba(255,255,255,.06); border-radius:10px; padding:8px 10px
  }
  details.hint summary{cursor:pointer; font-weight:700}
  .preview{
    margin-top:8px; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,.08);
    height:140px; background:#0b2b28;
  }
  .preview img{width:100%; height:100%; object-fit:cover}
  .footer{margin-top:10px; color:var(--muted); font-size:13px}

  .toast{
    position:fixed; left:50%; transform:translateX(-50%); bottom:16px;
    background:#112f2b; border:1px solid rgba(255,255,255,.08);
    color:var(--text); padding:10px 14px; border-radius:999px; box-shadow:var(--shadow);
    z-index:9; opacity:0; pointer-events:none; transition:opacity .3s, transform .3s;
  }
  .toast.show{opacity:1; transform:translate(-50%, -6px)}
  .sr-only{position:absolute !important; width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
  <div class="app">
    <section class="panel">
      <h1><span class="shrimp" aria-hidden="true"></span> Anoma Shrimp Puzzle</h1>

      <div class="row" role="group" aria-label="Difficulty">
        <div class="select" id="modeSelect">
          <button class="chip" data-n="3" aria-pressed="true">Easy 3×3</button>
          <button class="chip" data-n="4" aria-pressed="false">Medium 4×4</button>
          <button class="chip" data-n="5" aria-pressed="false">Hard 5×5</button>
        </div>
        <button id="shuffleBtn" class="btn">Shuffle</button>
      </div>

      <div class="row">
        <button id="toggleNums" class="btn secondary" aria-pressed="false" title="Show/Hide numbers">Show numbers</button>
      </div>

      <div class="board-wrap" id="boardWrap" aria-label="Sliding puzzle board">
        <div class="board" id="board" aria-live="polite"></div>
        <div class="sr-only" id="live">Ready</div>
      </div>

      <div class="hud">
        <div class="stat"><small>Moves</small><span id="moves">0</span></div>
        <div class="stat"><small>Time</small><span id="time">00:00</span></div>
        <div class="stat"><small>Best</small><span id="best">—</span></div>
      </div>

      <details class="hint">
        <summary>Hint / Preview</summary>
        <div class="preview"><img id="previewImg" src="shrimp.png" alt="Preview of full image"></div>
        <p class="footer">Use swipe on mobile, or arrow keys / WASD on desktop. Press H to toggle numbers.</p>
      </details>
    </section>

    <section class="panel">
      <h2 style="margin:0 0 8px;font-size:18px;color:var(--muted)">How to play</h2>
      <ol style="margin:0 0 12px 18px; line-height:1.5">
        <li>Choose a difficulty and press <b>Shuffle</b>.</li>
        <li>Slide tiles to reassemble the image. The blank space is the hole.</li>
        <li>Use swipe, arrow keys, or click/tap a tile next to the hole.</li>
      </ol>
    </section>
  </div>

<script>
(() => {
  // Helpers
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const formatTime = s => `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  const bestKey = n => `shrimpPuzzle_best_${n}`;

  // State
  let N = 3, order = [], hole = 0, moves = 0, secs = 0, timer = null, showNums = false;
  const imgURL = 'shrimp.png';

  // Elements
  const board = $('#board'), boardWrap = $('#boardWrap');
  const movesEl = $('#moves'), timeEl = $('#time'), bestEl = $('#best');
  const toggleNumsBtn = $('#toggleNums'), shuffleBtn = $('#shuffleBtn');

  // Build grid and tiles
  function buildBoard(){
    board.style.setProperty('--n', N);
    board.innerHTML = '';
    const total = N*N;

    for (let i=0;i<total;i++){
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.dataset.index = i; // correct index for this slice

      // Slice background
      const row = Math.floor(i/N), col = i%N;
      tile.style.backgroundImage = `url('${imgURL}')`;
      tile.style.backgroundSize = `${N*100}% ${N*100}%`;
      tile.style.backgroundPosition = `${(col/(N-1))*100}% ${(row/(N-1))*100}%`;

      // Clickable area
      const btn = document.createElement('button');
      btn.setAttribute('aria-label', `Tile ${i+1}`);
      btn.addEventListener('click', ()=> tryMoveByTile(tile));
      tile.appendChild(btn);

      // Number badge
      const badge = document.createElement('div');
      badge.className = 'num';
      badge.textContent = i+1;
      tile.appendChild(badge);

      board.appendChild(tile);
    }

    // The final tile is the "hole" (hidden)
    getTileByCorrectIndex(total-1).classList.add('hole');

    initSolvedOrder();
    applyOrderToDOM();
    setNumbersVisibility();
  }

  function setNumbersVisibility(){
    $$('.tile').forEach(t => t.classList.toggle('hidden-nums', !showNums));
    toggleNumsBtn.textContent = showNums ? 'Hide numbers' : 'Show numbers';
    toggleNumsBtn.setAttribute('aria-pressed', String(showNums));
  }

  // Position helpers
  const posToRC = pos => [Math.floor(pos/N), pos%N];
  const rcToPos = (r,c) => r*N + c;

  // Map position -> tile via grid-area
  function applyOrderToDOM(){
    for (let pos=0; pos<order.length; pos++){
      const correctIndex = order[pos];
      const [r,c] = posToRC(pos);
      const tile = getTileByCorrectIndex(correctIndex);
      // place tile at (r,c)
      tile.style.gridArea = `${r+1} / ${c+1} / ${r+2} / ${c+2}`;
    }
  }

  function getTileByCorrectIndex(idx){
    return board.querySelector(`.tile[data-index="${idx}"]`);
  }

  // Game logic
  function initSolvedOrder(){
    order = Array.from({length:N*N}, (_,i)=>i);
    hole = order.length - 1;
  }
  function solved(){
    for (let i=0;i<order.length;i++) if (order[i] !== i) return false;
    return true;
  }
  function updateHUD(){
    movesEl.textContent = moves;
    timeEl.textContent = formatTime(secs);
  }

  function validMovesFromHole(){
    const [r,c] = posToRC(hole);
    const dirs = [];
    if (r>0) dirs.push(0);       // up
    if (c<N-1) dirs.push(1);     // right
    if (r<N-1) dirs.push(2);     // down
    if (c>0) dirs.push(3);       // left
    return dirs;
  }

  // dir: 0=up,1=right,2=down,3=left (tile moving into hole)
  function slide(dir, countMove = true){
    const [r,c] = posToRC(hole);
    let fromPos;
    if (dir===0) fromPos = rcToPos(r-1,c);
    else if (dir===1) fromPos = rcToPos(r,c+1);
    else if (dir===2) fromPos = rcToPos(r+1,c);
    else if (dir===3) fromPos = rcToPos(r,c-1);
    else return;

    // swap tile at fromPos with hole
    [order[fromPos], order[hole]] = [order[hole], order[fromPos]];
    hole = fromPos;
    applyOrderToDOM();

    if (countMove){
      moves++; updateHUD();
      if (solved()){
        clearInterval(timer);
        const best = loadBest(N);
        if (!best || secs < best) saveBest(N, secs);
        renderBest();
        alert(`Solved in ${moves} moves • ${formatTime(secs)}`);
      }
    }
  }

  function tryMoveByTile(tileEl){
    const correctIndex = Number(tileEl.dataset.index);
    const pos = order.indexOf(correctIndex);
    const [tr,tc] = posToRC(pos);
    const [hr,hc] = posToRC(hole);
    const dr = tr-hr, dc = tc-hc;
    let dir = null;
    if (dr===-1 && dc===0) dir = 2;
    else if (dr===1 && dc===0) dir = 0;
    else if (dc===-1 && dr===0) dir = 1;
    else if (dc===1 && dr===0) dir = 3;
    if (dir!==null) slide(dir, true);
  }

  // Shuffle with a solvable random walk
  function shuffle(){
    initSolvedOrder();
    let last=-1;
    for (let k=0;k<200 + N*120;k++){
      const options = validMovesFromHole().filter(d=>Math.abs(d-last)!==2);
      const dir = options[Math.floor(Math.random()*options.length)];
      slide(dir, false);
      last = dir;
    }
    moves = 0; secs = 0; updateHUD();
    clearInterval(timer);
    timer = setInterval(()=>{ secs++; updateHUD(); }, 1000);
  }

  // Keyboard
  window.addEventListener('keydown', e=>{
    let dir=null;
    if (e.key==='ArrowUp' || e.key==='w' || e.key==='W') dir=2;
    else if (e.key==='ArrowRight' || e.key==='d' || e.key==='D') dir=3;
    else if (e.key==='ArrowDown' || e.key==='s' || e.key==='S') dir=0;
    else if (e.key==='ArrowLeft' || e.key==='a' || e.key==='A') dir=1;
    else if (e.key==='h' || e.key==='H'){ showNums=!showNums; setNumbersVisibility(); return; }
    else return;
    e.preventDefault();
    if (validMovesFromHole().includes(dir)) slide(dir, true);
  });

  // Swipe
  let touchStart=null;
  boardWrap.addEventListener('touchstart', e=>{
    const t=e.changedTouches[0];
    touchStart={x:t.clientX,y:t.clientY,t:e.timeStamp};
  }, {passive:true});
  boardWrap.addEventListener('touchend', e=>{
    if(!touchStart) return;
    const t=e.changedTouches[0];
    const dx=t.clientX-touchStart.x, dy=t.clientY-touchStart.y;
    const adx=Math.abs(dx), ady=Math.abs(dy), dt=e.timeStamp-touchStart.t;
    if(Math.max(adx,ady)<18 || dt>500) { touchStart=null; return; }
    let dir=null;
    if(adx>ady) dir = dx>0 ? 3 : 1; else dir = dy>0 ? 0 : 2;
    if (validMovesFromHole().includes(dir)) slide(dir, true);
    touchStart=null;
  }, {passive:true});

  // Buttons & mode switch
  $('#modeSelect').addEventListener('click', e=>{
    const b = e.target.closest('.chip'); if(!b) return;
    if (+b.dataset.n === N) return;
    $$('#modeSelect .chip').forEach(x=>x.setAttribute('aria-pressed','false'));
    b.setAttribute('aria-pressed','true');
    N = +b.dataset.n;
    buildBoard();
    moves = 0; secs = 0; updateHUD(); renderBest();
  });
  toggleNumsBtn.addEventListener('click', ()=>{ showNums=!showNums; setNumbersVisibility(); });
  shuffleBtn.addEventListener('click', shuffle);

  // Best time
  function saveBest(n, secs){ localStorage.setItem(bestKey(n), String(secs)); }
  function loadBest(n){ const v = localStorage.getItem(bestKey(n)); return v ? Number(v) : null; }
  function renderBest(){ const b = loadBest(N); bestEl.textContent = b ? formatTime(b) : '—'; }

  // Boot
  (function init(){
    buildBoard();
    renderBest();
    updateHUD();
    // Initial state is solved; press Shuffle to start timer/game.
  })();
})();
</script>
</body>
</html>
